var f=void 0,k=!0,m=null,n=!1;console={log:function(){}};var o=0,p=0,q=880,aa=220,r=135,ba=220,s=15,ca=1,u="rgb(240,240,240)",da="rgb(240,50,50)",v=11,w=30,x=22,ea=39,y=8,fa=8,ga="img/tree/",ha="ape.png bat.png beaver.png bird.png cat.png chimp.png cow.png dog.png dolphin.png elephant.png frog.png gopher.png horse.png human.png kangaroo.png lizard.png monkey.png mouse.png opossum.png rabbit.png ram.png rat.png shark.png sloth.png snake.png squirrel.png wolf.png".split(" "),ia=[],ja=30,ka=30,la=6446,z=20,A=20,ma=2,B=22,C=22,na=10,oa="rgb(240,240,240)",pa=
"rgba(240,240,240,0)",ra=10,sa=["rgb(99,182,250)","rgb(0,153,51)","rgb(153,0,204)","rgb(242,122,13)"],ta=["rgba(99,182,250,","rgba(0,153,51,","rgba(153,0,204,","rgba(242,122,13,"],ua=["rgb(176,218,253)","rgb(77,255,136)","rgb(217,102,255)","rgb(249,189,134)"],D=1,va=1,E=3,wa=3,xa="rgba(100,130,130,0.6)",ya="rgb(200, 20, 20)",za=2,Aa=879,Ba=30,F=120,Ca=30,G=0,Da=1E3,Ea=50,H=100,Fa=220,I=33,K=20,Ga="lang/",Ha=".json",L,M=9;function Ia(a){function b(a){var b=$(this).offset(),c=a.pageX-b.left,b=a.pageY-b.top,d=n,g;for(g in this.j.i)c>this.j.i[g].x&&c<this.j.i[g].x+this.j.i[g].width&&b>this.j.i[g].y&&b<this.j.i[g].y+this.j.i[g].height?(Ja(this.j.i[g],k)&&(d=k),"mousedown"==a.type&&Ka(this.j.i[g],k)?d=k:"mouseup"==a.type&&Ka(this.j.i[g],n)&&(d=k),"mouseup"==a.type&&this.j.i[g].fireEvent(new $.Event("clicked"))):Ja(this.j.i[g],n)&&(d=k);d&&this.j.o()}this.canvas=a;this.canvas.j=this;this.K=a.getContext("2d");this.i=[];var c=
[new La({k:"hdd",style:"white"}),new La({k:"folder-open",style:"white"})],d=[["Save States"],[Ma("bc-best"),m,c[1],"Best"],[Na("Best")],["1",c[0],c[1],"1"],[Na("1")],["2",c[0],c[1],"2"],[Na("2")]],e=[[""],["Best",m,function(){var a=localStorage.getItem(args.id+"-Best");a&&(a=JSON.parse(a),Oa(a))}],[],["1",function(){var a=Pa();localStorage.setItem(args.id+"-1",JSON.stringify(a));Qa(this,"1",a.l)},function(){var a=localStorage.getItem(args.id+"-1");a&&(a=JSON.parse(a),Oa(a))}],[],["2",function(){var a=
Pa();localStorage.setItem(args.id+"-2",JSON.stringify(a));Qa(this,"2",a.l)},function(){var a=localStorage.getItem(args.id+"-2");a&&(a=JSON.parse(a),Oa(a))}],[]],g;for(g in c)c[g].J("changed",function(){this.o()},this);this.data=[];for(g=0;g<d.length;g++){var l=g*B,c=[d[g][0]];d[g][1]?(button=new Ra(~~(a.width-2*I),~~(l+(B-K)/2),d[g][1],I,K),this.i.push(button),c.push(button)):c.push(m);d[g][2]?(button=new Ra(~~(a.width-I),~~(l+(B-K)/2),d[g][2],I,K),c.push(button),this.i.push(button)):c.push(m);c.push(d[g][3]);
this.data.push(c)}$(this.canvas).mousemove(b);$(this.canvas).mousedown(b);$(this.canvas).mouseup(b);$(this.canvas).mouseout(function(){var a=n,b;for(b in this.j.i)Ja(this.j.i[b],n)&&(a=k),Ka(this.j.i[b],n)&&(a=k);a&&this.j.o()});for(g=0;g<e.length;g++)for(a=0;a<e[g].length;a++)this.data[g][a]!=m&&("object"==typeof this.data[g][a]&&"function"==typeof e[g][a])&&this.data[g][a].J("clicked",e[g][a],this)}
function Qa(a,b,c){for(var d=0;d<a.data.length-1;d++)a.data[d][3]&&a.data[d][3]==b&&(a.data[d+1][0]=c);a.o()}function Na(a){return(a=localStorage.getItem(args.id+"-"+a))?(a=JSON.parse(a),a.l):m}
Ia.prototype.o=function(){var a=this.K,b=this.canvas.width,c=this.canvas.height;a.save();a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,b,c);a.restore();b=a.createLinearGradient(0,0,100,0);b.addColorStop(0,oa);b.addColorStop(1,pa);a.strokeStyle=b;a.fillStyle=oa;a.lineWidth=1;a.beginPath();for(b=0;b<=na;b++)a.moveTo(-0.5,b*B+0.5),a.lineTo(100.5,b*B+0.5);a.closePath();a.stroke();a.font="10pt sans-serif";a.textBaseline="middle";a.textAlign="left";for(b=0;b<this.data.length;b++)if(c=b*B,this.data[b][0]&&
"string"==typeof this.data[b][0]?a.fillText(this.data[b][0],5,c+B/2):this.data[b][0]&&"number"==typeof this.data[b][0]&&(a.save(),a.font="8pt sans-serif",a.textAlign="right",a.textBaseline="top",a.fillText(Ma("bc-score")+": "+this.data[b][0],H-I/3,c),a.restore()),this.data[b][1]&&(a.save(),a.translate(this.data[b][1].x,this.data[b][1].y),this.data[b][1].o(a),a.restore()),this.data[b][2])a.save(),a.translate(this.data[b][2].x,this.data[b][2].y),this.data[b][2].o(a),a.restore()};
function Ra(a,b,c,d,e){this.x=a;this.y=b;this.k=c;this.width=d;this.height=e;this.d=[];this.M=n}Ra.prototype.fireEvent=function(a){a.target=this;for(var b in this.d[a.type])a.U=b,this.d[a.type][b][0].call(this.d[a.type][b][1],a)};function Ka(a,b){return b!=a.R?(a.R=b,k):n}function Ja(a,b){return b!=a.M?(a.M=b,k):n}Ra.prototype.J=function(a,b,c){this.d[a]===f&&(this.d[a]=[]);this.d[a].push([b,c]);return this.d[a].length-1};
Ra.prototype.o=function(a){a.clearRect(0,0,this.width,this.height);this.R?(a.fillStyle="rgb(150,150,150)",a.fillRect(0,0,this.width,this.height)):this.M&&(a.fillStyle="rgb(200,200,200)",a.fillRect(0,0,this.width,this.height));if(this.k&&this.k.L){var b=~~((this.width-this.k.width)/2),c=~~((this.height-this.k.height)/2);a.drawImage(this.k.L,this.k.x,this.k.y,this.k.width,this.k.height,0<=b?b:0,0<=c?c:0,this.k.width,this.k.height)}};
function La(a){Sa||Ta();a.k?(this.x=Ua[a.k].x,this.y=Ua[a.k].y):(this.x=a.x,this.y=a.y);this.style="undefined"!==typeof a.style?a.style:"black";this.L=Va[this.style];this.height=this.width=14;this.d=[];Wa.push(this)}var Xa={black:"img/glyphicons-halflings.png",white:"img/glyphicons-halflings-white.png"},Ua={download:{x:120,y:24},upload:{x:144,y:24},"folder-open":{x:408,y:120},hdd:{x:0,y:144}},Va={},Sa=n,Wa=[];
function Ta(){Sa=k;for(var a in Xa){var b=new Image;b.key=a;b.onload=function(){for(var a in Wa)Wa[a].style==this.key&&(Wa[a].L=this,Wa[a].fireEvent(new $.Event("changed")))};b.onerror=function(){console.log("error loading BCIcon: "+this.key)};b.src=Xa[a];Va[a]=b}}La.prototype.fireEvent=function(a){a.target=this;for(var b in this.d[a.type])a.U=b,this.d[a.type][b][0].call(this.d[a.type][b][1],a)};
La.prototype.J=function(a,b,c){this.d[a]===f&&(this.d[a]=[]);this.d[a].push([b,c]);return this.d[a].length-1};function Ya(){this.N=-1;this.O=-4;this.W={T:1,A:2,G:4,C:8,".":16};this.s=["T","A","G","C","."];this.P={A:{A:1,C:-1,G:-1,T:-1,".":-1},C:{A:-1,C:1,G:-1,T:-1,".":-1},G:{A:-1,C:-1,G:1,T:-1,".":-1},T:{A:-1,C:-1,G:-1,T:1,".":-1},".":{A:-1,C:-1,G:-1,T:-1,".":0}};this.X={A:{A:0,C:0,G:0,T:0,".":1},C:{A:0,C:0,G:0,T:0,".":1},G:{A:0,C:0,G:0,T:0,".":1},T:{A:0,C:0,G:0,T:0,".":1},".":{A:1,C:1,G:1,T:1,".":0}}}
function Za(a){var b=$a;return function d(a,g){if(a instanceof Object&&a[0]!=f){if(g.count==b)return a;g.count+=1;var l=d(a[0],g);return l!=m?l:d(a[1],g)}return m}(a,{count:0})}function ab(){var a=N;return function c(d,e){if(d instanceof Object&&d[0]!=f){if(d==a)return e.count;e.count+=1;var g=c(d[0],e);return g!=m?g:c(d[1],e)}return-1}(O,{count:0})}var cb=function bb(b,c){return b instanceof Array?[bb(b[0],c),bb(b[1],c)]:c.shift()};function db(a){return a instanceof Array?db(a[0]):a.length}
function eb(a){function b(a){a-=a>>1&1431655765;a=(a>>2&858993459)+(a&858993459);a=(a>>4)+a&252645135;a+=a>>8;return a+(a>>16)&63}var c=fb,d=gb,e=function J(a,c,d,g){if(a instanceof Array){d.q==f&&(d.q=[],d.m=[],d[0]={},d[1]={});var e=J(a[0],c,d[0],g[0]),a=J(a[1],c,d[1],g[1]);d.q[c]=g.value==f||g.value[c]==f?0==(e&a)?e|a:e&a:1<<g.value[c];d.m[c]=Math.min(b((d.q[c]&-d.q[c])-1),4);return d.q[c]}d.q==f&&(d.q=[],d.m=[]);d.q[c]=a;d.m[c]=Math.min(b((a&-a)-1),4);return a};console.log(b(15));console.log(b(0));
for(var g=[],l=db(a),j=0;j<l;j++){var h=hb(c,a,j);g[j]=h.z}a=[];for(j=0;j<g.length;j++)e(g[j],j,a,d);d="";for(j=0;j<a.m.length;j++)d+=c.s[a.m[j]];(function qa(a,b){if(a instanceof Array||a instanceof Object&&a[0]!=f){qa(a[0],b);qa(a[1],b);a.I="";for(var c=0;c<a.m.length;c++)a.I+=b[a.m[c]]}})(a,c.s);j={match:0,mismatch:0,gap_ext:0,gap_open:0};c=c.oa.bind(c)(a,j);e={};e.m=d;e.l=c;e.z=a;e.info=j;return e}
Ya.prototype.oa=function ib(b,c){if(b instanceof Object&&b[0]!=f){var d,e=0;d=0+ib.bind(this)(b[0],c);d+=ib.bind(this)(b[1],c);e+=jb(this,b.m,b[0].m,c);e+=jb(this,b.m,b[1].m,c);b.l=d+e;return d+e}return 0};
function jb(a,b,c,d){for(var e=0,g=n,l=0,j=k,h=0;h<b.length;h++)1==a.X[a.s[b[h]]][a.s[c[h]]]?j||(g?(e+=a.N,d.gap_ext+=1,l++):(e+=a.O,g=k,d.gap_open+=1,l=1)):(j=g=n,e+=a.P[a.s[b[h]]][a.s[c[h]]],0<a.P[a.s[b[h]]][a.s[c[h]]]?d.match+=1:d.mismatch+=1);g&&(e-=(l-1)*a.N+a.O,d.gap_ext-=l-1,d.gap_open-=1);return e}
function hb(a,b,c){var d=[0],a=kb(a,b,c),b=function g(a,b){if(a instanceof Array){var c=g(a[0],b),d=g(a[1],b);0==(c&d)?(b[0]++,a.q=c|d):a.q=c&d;return a.q}return a}(a,d),c={};c.m=b;c.ta=d[0];c.z=a;return c}function kb(a,b,c){return b instanceof Array?[kb(a,b[0],c),kb(a,b[1],c)]:a.W[b.charAt(c)]}var fb=new Ya;function lb(){function a(a){return function(){var b=new Settings;$("#options-size-xlarge").removeClass("active");$("#options-size-large").removeClass("active");$("#options-size-medium").removeClass("active");$("#options-size-small").removeClass("active");$(this).addClass("active");b.set("options-size",this.id);if(P)for(b=0;b<Q.length;b++)for(var c=0;c<Q[b].length;c++)Q[b][c].top=Math.round(Q[b][c].top/B)*(a+ma),Q[b][c].left=Math.round(Q[b][c].left/C)*(a+ma);z=A=a;x=C=B=a+ma;K=C-2;ba=Fa=aa=aa=B*ra;
v=~~(C/2);F=E*(q/C);$("#ancestor-selection-box").width(C).height(B).css({"border-width":z+"px"});mb()}}function b(a,b){var d=c.get(a);if(d==m)return $("#"+b).addClass("active"),c.set(a,b),b;$("#"+d).addClass("active");return d}var c=new Settings;$("#stats-submit").click(function(){$.ajax("dummysubmit.php",{type:"POST",success:function(a){alert(a)},error:function(a,b){alert(b)},data:Pa()})});$("#stage-redirect").bind("keydown",function(a){if(13==(a.keyCode?a.keyCode:a.which?a.which:a.charCode)){var b=
document.location.search.replace("?",""),c="";if(b){var b=b.split("&"),d;for(d in b)-1==b[d].indexOf("id")&&(c+=b[d]+"&")}c="?"+c+"id="+$(this).val();document.location.search=c;a.preventDefault();return n}return k});$("#options-language-english").click(function(){$("#options-language-french").removeClass("active");$("#options-language-english").addClass("active");c.set("options-language",this.id)});$("#options-language-french").click(function(){$("#options-language-english").removeClass("active");
$("#options-language-french").addClass("active");c.set("options-language",this.id)});b("options-language","options-language-english");$("#options-size-small").click(a(20));$("#options-size-medium").click(a(25));$("#options-size-large").click(a(30));$("#options-size-xlarge").click(a(40));var d=b("options-size","options-size-small");$("#"+d).click();$("#options-misc-subscore").click(function(){var a=$(this);a.hasClass("active")?(args.ui_showscore=n,a.removeClass("active"),c.set("options-misc-subscore",
n)):(args.ui_showscore=k,a.addClass("active"),c.set("options-misc-subscore",k));nb()});d=c.get("options-misc-subscore");d==m?c.set("options-misc-subscore",n):d&&$("#options-misc-subscore").addClass("active");args.ui_showscore=!!c.get("options-misc-subscore");$(".collapse").collapse()};function ob(){var a=pb,b="ajax/fetch.php?";args.space&&(b=b+"space="+args.space+"&");args.name&&(b=b+"name="+args.name+"&");b=args.id?b+"id="+args.id+"&":b+"id=3871&";$.getJSON(b,function(b){var d=qb(b);a(d,b)})}
function qb(a){var b=[];(function l(a,b){a instanceof Array?(l(a[0],b),l(a[1],b)):b.push(a)})(a,b);for(var a=Array(b.length),c=0;c<b.length;c++){a[c]=[];var d,e;for(e=d=0;d<b[c].length;d++,e++)switch(b[c].charAt(d)){case "A":a[c][e]={id:0,r:d};break;case "U":case "T":a[c][e]={id:1,r:d};break;case "C":a[c][e]={id:2,r:d};break;case "G":a[c][e]={id:3,r:d};break;default:e--}}return a};var rb,sb={"bc-best":["body","play","gameselect","game_board","field_4"],"bc-score":["body","play","gameselect","game_board","field_1"],"sb-best":["body","play","gameselect","game_board","field_4"],"sb-par":["body","play","gameselect","game_board","field_2"],"t-ancestor":[]};function Ma(a){var b=function d(a,b,l,j){return l==b.length?"string"==typeof a?a:j:d(a[b[l]],b,l+1,j)};return rb?(b=b(rb,sb[a],0,a),"bc-best"==a||"sb-best"==a?b.split(" ")[0]:b):a}
function tb(){var a;a||(a="en-us");(function(a,c){$.getJSON(Ga+a+Ha,function(d){console.log(Ga+a+Ha);c(d)})})(a,function(a){rb=L=a;console.log("lang set");$("label[for='stats-matches']").html(L.body.play.gameselect.game_board.field_9);$("label[for='stats-gapexts']").html(L.body.play.gameselect.game_board.field_12);$("label[for='stats-stage']").html(L.body.play.gameselect.game_board.field_3);$("label[for='stats-mismatches']").html(L.body.play.gameselect.game_board.field_10);$("label[for='stats-gaps']").html(L.body.play.gameselect.game_board.field_11);
$("label[for='stats-par']").html(L.body.play.gameselect.game_board.field_2);$("label[for='scores-best']").html(L.body.play.gameselect.game_board.field_4);$("label[for='scores-score']").html(L.body.play.gameselect.game_board.field_1);$("#menu-play > a").html(L.header.field_1);$("#menu-highscores > a").html(L.header.field_7);$("#menu-contact > a").html(L.header.field_3);$("#stage-redirect").attr("placeholder",L.body.play.gameselect.levelselect.level_id.field_2);mb()})}$(function(){tb()});function ub(a,b,c){if(0==b)c=b=a=c;else var d=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a},e=0.5>c?c*(1+b):c+b-c*b,g=2*c-e,c=d(g,e,a+1/3),b=d(g,e,a),a=d(g,e,a-1/3);return[255*c,255*b,255*a]}
function vb(a){this.canvas=a;this.K=a.getContext("2d");this.e=10;this.g=this.h=0;this.a={animate:{f:{left:0,right:0,t:10,h:0,g:0,e:0},p:{left:0,right:0,t:10,h:0,g:0,e:0},c:{left:0,right:0,t:10,h:0,g:0,e:0},interval:20,duration:500,handle:m,start:m,qa:function(a){return 1-Math.sin(Math.acos(a))},ra:function(a){return Math.sin(Math.acos(1-a))},ga:function(a){return 0.5>a?0.5-Math.sin(Math.acos(2*a))/2:0.5+Math.sin(Math.acos(2-2*a))/2},step:function(a,c){c.animate.c.left=c.animate.f.left+(c.animate.p.left-
c.animate.f.left)*a;c.animate.c.right=c.animate.f.right+(c.animate.p.right-c.animate.f.right)*a;c.animate.c.e=c.animate.f.e+(c.animate.p.e-c.animate.f.e)*a;c.animate.c.h=c.animate.f.h+(c.animate.p.h-c.animate.f.h)*a;c.animate.c.g=c.animate.f.g+(c.animate.p.g-c.animate.f.g)*a;c.animate.c.t=Math.pow(10,Math.floor(Math.log(c.animate.c.right-c.animate.c.left)/Math.log(10)-0.4))}},Q:0.4,H:100,ma:100,n:{ha:"rgba(200,200,200,0.3)",ia:"rgba(200,200,200,0.9)",ea:"rgb(120,250,120)",ka:"rgb(120,120,250)",fa:"rgb(120,250,120)",
la:"rgb(120,120,250)",sa:"",$:[0,1,0.5],aa:[0.2,1,0.5],Z:[0.44,1,0.5],ba:30,Y:0.9,ca:"white",da:"rgba(0,0,0,0.9)",na:"rgba(220,220,220,0.9)"}};this.d={"best-click":[]};this.a.animate.o=this.o;return k}
vb.prototype.o=function(){"undefined"!==typeof wb&&xb&&(this.canvas.width=yb);var a=this.K,b=this.canvas.width,c=this.canvas.height,d=this.a.animate;a.save();a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,b,c);a.restore();var b=b-(this.a.H+this.a.ma),e=b/(d.c.right-d.c.left),g=Math.abs(Math.min(d.c.left,0))/(d.c.right-d.c.left)*b+this.a.H;a.font="10pt sans-serif";a.textBaseline="bottom";a.textAlign="center";a.strokeStyle=this.a.n.ha;a.fillStyle=this.a.n.ia;a.lineWidth=1;a.beginPath();for(var l=g;l<=
this.canvas.width;)a.moveTo(~~l+0.5,0),a.lineTo(~~l+0.5,c),a.fillText(""+Math.round(10*((l-g)/e))/10,l,c),l+=d.c.t*e;for(l=g;0<=l;)a.moveTo(~~l+0.5,0),a.lineTo(~~l+0.5,c),a.fillText(Math.round(10*((l-g)/e))/10,l,c),l-=d.c.t*e;a.closePath();a.stroke();var l=this.a.animate.c.e*e,j;j===f&&(j=this.a.animate.c.e);d=Math.abs(j-this.g)/this.a.n.ba;1<d&&(d=1);var h=this.a.n.aa,t=this.a.n.$;j>=this.g&&(t=this.a.n.Z);a.fillStyle="rgba("+~~(ub(d*(t[0]-h[0])+h[0],d*(t[1]-h[1])+h[1],d*(t[2]-h[2])+h[2])[0]+0.5)+
","+~~(ub(d*(t[0]-h[0])+h[0],d*(t[1]-h[1])+h[1],d*(t[2]-h[2])+h[2])[1]+0.5)+","+~~(ub(d*(t[0]-h[0])+h[0],d*(t[1]-h[1])+h[1],d*(t[2]-h[2])+h[2])[2]+0.5)+","+this.a.n.Y+")";a.textBaseline="middle";d=this.a.animate.c.e;h=this.canvas.height;j=h*(1-this.a.Q)/2;h*=this.a.Q;t=Math.min(d*e+g,g);d=Math.abs(d*e);a.beginPath();a.rect(t,j,d,h);a.closePath();a.fill();a.fillStyle=this.a.n.ca;a.lineWidth=2;a.save();a.shadowColor=this.a.n.da;a.shadowOffsetX=a.shadowOffsetY=0;a.shadowBlur=2;a.fillText(Math.round(this.a.animate.c.e),
l/2+g,c/2);a.restore();l=~~(g+this.a.animate.c.h*e)+0.5;a.textBaseline="top";a.textAlign="left";a.fillStyle=this.a.n.fa;a.fillText(Ma("sb-best")+": "+Math.round(this.a.animate.c.h),b+this.a.H+10,0);a.beginPath();a.moveTo(l,0);a.lineTo(l,c);a.closePath();a.strokeStyle=this.a.n.ea;a.stroke();l=~~(g+this.a.animate.c.g*e)+0.5;a.textBaseline="middle";a.fillStyle=this.a.n.la;a.fillText(Ma("sb-par")+": "+Math.round(this.a.animate.c.g),b+this.a.H+10,c/2);a.beginPath();a.moveTo(l,0);a.lineTo(l,c);a.closePath();
a.strokeStyle=this.a.n.ka;a.stroke();a.save();a.font="22pt sans-serif";a.fillStyle=this.a.n.na;a.textAlign="center";a.textBaseline="middle";a.fillText(Math.round(this.a.animate.c.e),this.a.H/2,c/2);a.restore()};
vb.prototype.recalc=function(){var a=1.2*Math.min(this.e,this.h,this.g),b=1.2*Math.max(this.e,this.h,this.g);0<a&&(a=0);0>b&&(b=0);if(10>b-a)var c=5-(b-a)/2,b=b+c,a=a-c;this.a.animate.f.left=this.a.animate.c.left;this.a.animate.f.right=this.a.animate.c.right;this.a.animate.f.t=this.a.animate.c.t;this.a.animate.f.e=this.a.animate.c.e;this.a.animate.f.h=this.a.animate.c.h;this.a.animate.f.g=this.a.animate.c.g;this.a.animate.p.left=a;this.a.animate.p.right=b;this.a.animate.p.t=Math.pow(10,Math.floor(Math.log(b-
a)/Math.log(10))-2);this.a.animate.p.e=this.e;this.a.animate.p.h=this.h;this.a.animate.p.g=this.g;(function(a){var b=a.a.animate;b.handle!=m&&(clearInterval(b.handle),b.handle=m);b.start=new Date;b.handle=setInterval(function(){var c=(new Date-b.start)/b.duration;c>1&&(c=1);b.step(b.ga(c),a.a);a.o();if(c==1){clearInterval(b.handle);b.handle=m}},b.interval)})(this)};function zb(a,b,c){c="undefined"!==typeof c?c:k;a.e=b;b>a.h&&Ab(a,b);c&&a.recalc()}
function Ab(a,b){var c=n;a.h=b;("undefined"!==typeof c?c:k)&&a.recalc()}function Bb(a,b,c){a.g=b;("undefined"!==typeof c?c:k)&&a.recalc()}vb.prototype.fireEvent=function(a){a.target=this;for(var b in this.d[a.type])a.U=b,this.d[a.type][b][0].call(this.d[a.type][b][1],a)};vb.prototype.J=function(a,b,c){this.d[a]===f&&(this.d[a]=[]);this.d[a].push([b,c]);return this.d[a].length-1};var Q=[],R,P,S,Cb,T,U,V,W,Db,X=[],O,gb,N,$a,Eb={fitch:n},Fb=-1E4,Gb,Hb,Y,Ib,Jb=n,wb={},xb,yb,Kb,Lb,Z=n;$(function(){lb();ob()});
function Mb(a,b){if(!Jb){Jb=k;clearInterval(Gb);clearInterval(Hb);Q=[];W=m;Db=b;X=[];Eb={fitch:n};O=m;Fb=-1E4;for(var c=0;c<a.length;c++){Q[c]=[];var d=c,e=c*B,g=a[c];if(args.rand!=f)var l=Nb(g.length);for(var j=0;j<g.length;j++)3<g[j].id||(Q[d][j]=[],Q[d][j].V=d,Q[d][j].left=args.rand?o+l[j]:g[j].r*C,Q[d][j].top=e,Q[d][j].b=k,Q[d][j].u=g[j].id);Ob(c)}V=[];fitchCalculator=new Ya;Db=b;$(document).unbind();P=$("#drawing-area").unbind().get(0);P.width=q;P.height=aa;R=P.getContext("2d");S=$("#tree-area").unbind().get(0);
S.width=r;S.height=ba;Cb=S.getContext("2d");T=$("#viewport").unbind().get(0);T.width=Aa;T.height=Ba;U=T.getContext("2d");c=$("#scorebar-area").unbind().get(0);c.width=Da;c.height=Ea;Y=new vb(c);var h,c=Y;h="undefined"!==typeof h?h:k;zb(c,0,n);Ab(c,0);Bb(c,0,n);h&&c.recalc();h=$("#buttoncolumn-area").unbind().get(0);h.width=H;h.height=Fa;Ib=new Ia(h);Ib.o();0<$("#stats-par").text().length&&Bb(Y,$("#stats-par").text());Pb();Qb();Rb();V.b=k;Q.b=k;Gb=setInterval(Sb,33);Z=k;Tb();Hb=setInterval(Tb,400);
Jb=n}}function pb(a,b){Ub(function(){Mb(a,b);Bb(Y,$("#scores-score").text());$("#stats-par").text($("#scores-score").text())})}function Ub(a){function b(a,b){var c=ia,d=new Image;d.onload=function(){b.count+=1;c.push(this)};d.onerror=function(){b.count+=1};d.src=a}function c(){d.count<e?(console.log("still waiting"),setTimeout(c,20)):(console.log("images loaded"),a())}for(var d={count:0},e=0,g=0;g<ha.length;g++)b(ga+ha[g],d),e++;setTimeout(c,0)}function Vb(a){this.pa=args.id;this.z=a;this.l=Y.e}
function Pa(){var a=Wb();return new Vb(a)}function Oa(a){args.id=a.pa;var b=qb(a.z);Mb(b,a.z)}function Wb(){for(var a=Array(Q.length),b=0,c=0;c<Q.length;c++)Q[c][Q[c].length-1].left>b&&(b=Q[c][Q[c].length-1].left);b=Math.ceil(b/C+1);console.log("max "+b);for(var c=["A","T","C","G"],d=0;d<Q.length;d++){var e=Array(b),g;for(g=0;g<b;g++)e[g]=".";for(g=0;g<Q[d].length;g++)e[~~((Q[d][g].left+C/2)/C)]=c[Q[d][g].u];a[d]=e.join("")}return cb(Db,a)}
function Tb(){if(Z){Z=n;var a=Wb(),a=eb(a);N?($a=ab(),0>$a&&($a=0)):$a=0;(N=Za(a.z))?Xb(N.I):Xb(a.m);$("#stats-matches").text(a.info.match);$("#stats-gapexts").text(a.info.gap_ext);$("#stats-mismatches").text(a.info.mismatch);$("#stats-gaps").text(a.info.gap_open);$("#scores-score").text(a.l);zb(Y,a.l);if(a.l>Fb){$("#scores-best").text(a.l);Fb=a.l;var b=localStorage.getItem(args.id+"-Best");if(b&&JSON.parse(b).l<Fb||!b)b=Pa(),console.log(b),localStorage.setItem(args.id+"-Best",JSON.stringify(b)),
Qa(Ib,"Best",b.l)}O=a.z;Q.b=k;Eb.S=k}}function Xb(a){var b=[],c=[],d,e;for(e=d=0;d<a.length;d++,e++)switch(a.charAt(d)){case "A":b[e]={id:0,r:d};break;case "U":case "T":b[e]={id:1,r:d};break;case "C":b[e]={id:2,r:d};break;case "G":b[e]={id:3,r:d};break;default:e--}for(d=0;d<b.length;d++)3<b[d].id||(c[d]=[],c[d].V=M,c[d].left=b[d].r*C,c[d].top=M*B,c[d].b=k,c[d].u=b[d].id);X=c}
function Pb(){var a=m,b=0,c=n,d="",e;$(document).mousedown(function(g){console.log(d);if("select"!=d){var e=$(P).offset(),j=g.pageX-e.left-o,g=g.pageY-e.top-p,h=~~(g/B);a=m;c=k;if(h!=M){if(0<=h&&h<Q.length)for(e=0;e<Q[h].length;e++)if(Q[h][e].left+C>j&&Q[h][e].left<j){a=Q[h][e];a.B=k;b=j-Q[h][e].left;if(W){W.x=j;W.y=g;for(e=0;e<Q.length;e++)for(g=0;g<Q[e].length;g++)Q[e][g].selected&&(Q[e][g].B=k,Q[e][g].ja=Q[e][g].left)}break}a==m&&(b=j);d="main"}else $("#ancestor-selection-box").css({top:M*B+e.top-
z,left:~~(j/C)*C+e.left+o-z}).show(),d="ancestor-change"}});$(document).mouseup(function(b){c=n;switch(d){case "main":if(a!=m){a.B=n;if(W)for(b=0;b<Q.length;b++)Ob(b);else Ob(a.V);Rb();a=m}else{for(b=0;b<Q.length;b++)for(var l=0;l<Q[b].length;l++)Q[b][l].selected=n,Q[b][l].B=n;W=m;d="";Q.b=k}break;case "viewport":o=~~o;V.b=k;Q.b=k;break;case "select":$("#selection-box").hide();W.state="selected";d="";break;case "ancestor-change":var b=Yb(b.pageX,b.pageY),l=$(P).offset(),j=$("#ancestor-selection-box").offset();
$("#ancestor-selection-box").hide();var h={top:1,left:0,bottom:3,right:2};Zb(~~((j.left-l.left-o+C)/C),0.7<b[b.dir]?h[b.dir]:4);Z=k;e=m;d=""}});$(document).mousemove(function(g){0===g.which&&(c=n);if(c)switch(d){case "main":if(a!=m){var e=g.pageX-$(P).offset().left;if(W){for(var e=W.x+o-e,j=0;j<Q.length;j++)for(var h=0;h<Q[j].length;h++)Q[j][h].selected&&(Q[j][h].left=Q[j][h].ja-e);Q.b=k}else a.left=e-o-b;Z=k;Qb()}else e=g.pageX-$(P).offset().left,o=-(b-e),o=Math.min(Math.max(-la+q,o),0),G=-(o/C*
E),Q.b=k;break;case "ancestor-change":e=$(P).offset();e=Yb(g.pageX,g.pageY);$("#ancestor-selection-box").css({"border-top-color":ta[0]+e.top+")","border-left-color":ta[1]+e.left+")","border-bottom-color":ta[2]+e.bottom+")","border-right-color":ta[3]+e.right+")"});break;case "viewport":e=g.pageX-$(T).offset().left,G=Math.min(Math.max(0,e-F/2),Aa-F),o=-(G/E*C),V.b=k,Q.b=k}else switch(d){case "select":if("start"==W.state){W.v.x=g.pageX;W.v.y=g.pageY;var j=W.F.y>W.v.y?W.v.y:W.F.y,g=W.F.x>W.v.x?W.v.x:
W.F.x,t=Math.abs(W.F.x-W.v.x),h=Math.abs(W.F.y-W.v.y),e=$(P).offset(),J=~~((j-e.top-p)/B),qa=~~((j+h-e.top-p)/B);a.offset({top:j,left:g}).width(t).height(h);for(j=0;j<Q.length;j++)for(h=0;h<Q[j].length;h++)Q[j][h].selected=n;for(j=0<=J?J:0;j<Q.length&&j<=qa;j++){for(h=0;h<Q[j].length&&!(Q[j][h].left+e.left+o+C>g);h++);for(;h<Q[j].length&&Q[j][h].left+e.left+o<t+g;h++)Q[j][h].selected=k}Q.b=k}}});$(document).dblclick(function(b){if(W){for(b=0;b<Q.length;b++)for(var c=0;c<Q[b].length;c++)Q[b][c].selected=
n,Q[b][c].B=n;W=m;d="";Q.b=k}else a=$("#selection-box").show().offset({top:b.pageY,left:b.pageX}).width(0).height(0),d="select",W={state:"start",F:{x:b.pageX,y:b.pageY},v:{x:b.pageX,y:b.pageY}}});$(T).mousedown(function(a){if("select"!=d)return a=a.pageX-$(T).offset().left,c=k,b=a,d="viewport",n});$(S).mousemove(function(a){var b=$(S).offset(),a=function h(a,b,c){if(a instanceof Object&&a[0]!=f){if(a.w&&a.w.left<b&&a.w.left+a.w.width>b&&a.w.top<c&&a.w.top+a.w.height>c)return a;var d=h(a[0],b,c);return d!=
m?d:d=h(a[1],b,c)}return m}(O,a.pageX-b.left,a.pageY-b.top);a!=m?a!=N&&(e=N,N=a,nb(),Xb(N.I),Q.b=k):(N!=e&&e!=m&&(N=e,nb(),Xb(N.I),Q.b=k),e=m)});$(S).mousedown(function(){e=N})}function Zb(a,b){var c=N;console.log(a,b);c=function e(a,b,c){if(a instanceof Object&&a[0]!=f){if(c==a)return b;var h=e(a[0],b[0],c);return h!=m?h:h=e(a[1],b[1],c)}return m}(O,gb,c);c!=m&&(c.value[a]=b)}
function Rb(){var a=db(Db)+20;gb=cb(Db,Array(Q.length));(function c(a,e){a instanceof Object&&a[0]!=f&&(c(a[0],e),c(a[1],e),a.value=Array(e))})(gb,a);gb.set=n}
function Yb(a,b){var c=$("#ancestor-selection-box").offset(),d={top:-0.2,left:-0.2,bottom:-0.2,right:-0.2},e=a-(c.left+1.5*z),g=b-(c.top+1.5*A),c=-Math.atan2(g,e),e=Math.min(Math.max(Math.sqrt(e*e+g*g)/(2*z),0.2),1);Math.abs(c)<Math.PI/4?(d.right=1,d.dir="right"):Math.abs(c)>0.75*Math.PI?(d.left=1,d.dir="left"):0<c?(d.top=1,d.dir="top"):(d.bottom=1,d.dir="bottom");d.top=d.top*e+0.4;d.left=d.left*e+0.4;d.right=d.right*e+0.4;d.bottom=d.bottom*e+0.4;return d}
function Nb(a){for(var b=la-C,c=[],d=0;d<a;d++)c[d]=Math.floor(Math.random()*b);return c=c.sort(function(a,b){return a-b})}function Ob(a){for(var b=0;b<Q[a].length;b++)Q[a][b].left=~~((Q[a][b].left+C/2)/C)*C,Q[a][b].b=k}
function Qb(){var a=n,b=0,c,d;for(c=0;c<Q.length;c++){a=n;b=la;for(d=Q[c].length-1;0<=d;d--)Q[c][d].B?(a=k,Q[c][d].b=k):a&&Q[c][d].left>b-C&&(Q[c][d].left=b-C,Q[c][d].b=k),b=Q[c][d].left;a=n;b=-C;for(d=0;d<Q[c].length;d++)Q[c][d].B?(a=k,Q[c][d].b=k):a&&Q[c][d].left<b+C&&(Q[c][d].left=b+C,Q[c][d].b=k),b=Q[c][d].left;b=-C;for(d=0;d<Q[c].length;d++)Q[c][d].left<b+C&&(Q[c][d].left=b+C,Q[c][d].b=k),b=Q[c][d].left;b=la;for(d=Q[c].length-1;0<=d;d--)Q[c][d].left>b-C&&(Q[c][d].left=b-C,Q[c][d].b=k),b=Q[c][d].left}}
function $b(){for(var a=R,b=0;b<X.length;b++)X[b].left+o+D>=-C&&X[b].left+o+D+C<=q+C&&(a.fillStyle=sa[X[b].u],a.fillRect(X[b].left+o+D,X[b].top+p+va,z,A)),X[b].b=n}
function Sb(){xb&&(P.width=Kb,T.width=Lb,xb=n,Q.b=k);if(Q.b){R.save();R.setTransform(1,0,0,1,0,0);R.clearRect(0,0,P.width,P.height);R.restore();ac();for(var a=0;a<Q.length;a++)for(var b=a,c=R,d=0;d<Q[b].length;d++)Q[b][d].left+o+D>=-C&&Q[b][d].left+o+D+C<=q+C&&(c.fillStyle=Q[b][d].selected?ua[Q[b][d].u]:sa[Q[b][d].u],c.fillRect(Q[b][d].left+o+D,Q[b][d].top+p+va,z,A)),Q[b][d].b=n;$b();Q.b=n;bc(k)}else{b=n;R.save();for(a=0;a<Q.length;a++){for(c=0;c<Q[a].length&&!Q[a][c].b;c++);c<Q[a].length&&(R.setTransform(1,
0,0,1,0,0),R.clearRect(0,B*a+p,q,B),b=k,Q[a].b=k)}R.restore();if(b){ac();for(a=0;a<Q.length;a++)if(Q[a].b){for(c=0;c<Q[a].length;c++)Q[a][c].left+o+D>=-C&&Q[a][c].left+o+D+C<=q+C&&(R.fillStyle=Q[a][c].selected?ua[Q[a][c].u]:sa[Q[a][c].u],R.fillRect(Q[a][c].left+o+D,Q[a][c].top+p+va,z,A)),Q[a][c].b=n;Q[a].b=n}$b();bc(k)}else bc(n)}Eb.S&&(nb(),Eb.S=n)}
function bc(a){if(a||V.b){U.save();U.setTransform(1,0,0,1,0,0);U.clearRect(0,0,T.width,T.height);U.restore();for(var b=a=0;b<Q.length;b++)for(var c=0;c<Q[b].length;c++)U.fillStyle=sa[Q[b][c].u],a=~~(Q[b][c].left/C),U.fillRect(a*E,b*wa,E,wa);U.fillStyle=xa;U.fillRect(0,0,G,Ca);U.fillRect(G+F,0,Aa-G-F,Ca);U.strokeStyle=ya;U.lineWidth=za;U.strokeRect(G,0,F,Ca);V.b=n}}
function ac(){var a=R;a.beginPath();for(var b=0;b<=na;b++)a.moveTo(-0.5,p+b*B+0.5),a.lineTo(q+0.5,p+b*B+0.5);for(var b=~~(q/C)+1,c=0;c<=b;c++)a.moveTo(o%C+c*C+0.5,p+0.5),a.lineTo(o%C+c*C+0.5,p+na*B-1+0.5);a.lineWidth=1;a.strokeStyle=oa;a.stroke();a.closePath()}
function nb(){var a=Cb,b=function l(b,c){b instanceof Object&&b[0]!=f&&(l(b[0],c),l(b[1],c),(!c&&b.D!=N||c&&b.D==N)&&a.rect(r-(b.depth*s+w)-y/2,v+~~(b.height*x)-fa/2,y,fa),b.D.w={top:v+~~(b.height*x)-y/2,left:r-(b.depth*s+w)-y/2,width:y,height:fa})},c=function j(b){b instanceof Object&&b[0]!=f&&(j(b[0]),j(b[1]),a.fillText(0<b.D.l?"+"+b.D.l:""+b.D.l,r-(b.depth*s+w)-3,v+~~(b.height*x)))},d={};(function h(a,b,c){if(a instanceof Object&&a[0]!=f){var d=0;b[0]={};b[1]={};var e=h(a[0],b[0],c),c=h(a[1],b[1],
c),d=Math.max(e.depth,d),d=Math.max(c.depth,d);b.depth=d+1;b.height=(e.height+c.height)/2;b.f=e.height;b.p=c.height;b.D=a}else b.depth=0,b.height=c[0],c[0]+=1;return b})(O,d,[0]);a.save();a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,S.width,S.height);a.restore();var e=a.createLinearGradient(r,0,r-ea,0);e.addColorStop(0,oa);e.addColorStop(1,pa);a.strokeStyle=e;a.lineWidth=1;a.beginPath();for(e=0;e<=na;e++)a.moveTo(r-ea+0.5,e*B+0.5),a.lineTo(r+0.5,e*B+0.5);a.closePath();a.stroke();(function t(b,c){b instanceof
Object&&b[0]!=f?(t(b[0],b.depth,c),c=t(b[1],b.depth)):a.drawImage(ia[c],0,0,ia[c].width,ia[c].height,r-30,v+~~(b.height*x)-ka/2,ja,ka);return c+1})(d,0);a.font="12px sans-serif";a.textBaseline="middle";a.textAlign="right";a.fillStyle=u;a.fillText("Ancestor",r-5,B*M+B/2);a.fillStyle=u;a.strokeStyle=u;a.beginPath();(function J(b,c){b instanceof Object&&b[0]!=f&&(J(b[0],b.depth),J(b[1],b.depth),a.moveTo(r-(b.depth*s+w),v+~~(b.f*x)),a.lineTo(r-(b.depth*s+w),v+~~(b.p*x)));a.moveTo(r-(b.depth*s+w),v+~~(b.height*
x));a.lineTo(r-(c*s+w),v+~~(b.height*x))})(d,8);a.closePath();a.lineWidth=ca;a.lineCap="square";a.stroke();a.fill();a.fillStyle=u;a.beginPath();b(d,n);a.closePath();a.fill();a.fillStyle=da;a.beginPath();b(d,k);a.closePath();a.fill();args.ui_showscore&&(a.font="10px sans-serif",a.textBaseline="bottom",a.textAlign="right",a.fillStyle=u,c(d))};$(window).resize(function(){var a=0.8*$(window).width()-r-H;1E3<a?a=1E3:300>a&&(a=300);q=a;E=a/293;Da=Aa=a+r+H;F=E*(q/C);xb=k;Kb=a;Lb=a+r+H;yb=Da;Y&&Y.o()});function mb(){if(P){Qb();for(i=0;i<Q.length;i++)Ob(i);S.height=P.height=aa;var a=$("#buttoncolumn-area").unbind().get(0);a.width=H;a.height=Fa;Ib=new Ia(a);Ib.o();Z=Q.b=k;Tb();Sb();nb()}}$(window).resize();
